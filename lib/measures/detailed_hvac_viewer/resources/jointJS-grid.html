<!DOCTYPE html>
<html lang="en">
<head>
    <title>JointJS Grid Layout</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.4.0/backbone-min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@joint/core@4.0.1/dist/joint.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jointjs/3.4.0/joint.css" />
    <style>
        #paper {
            width: 800px;
            height: 600px;
            border: 1px solid #000;
        }
    </style>
</head>
<body>
    <div id="paper"></div>

<script>
    // Create a JointJS graph
    const graph = new joint.dia.Graph();

    // Create a JointJS paper and attach it to the DOM
    const paper = new joint.dia.Paper({
        el: document.getElementById('paper'),
        model: graph,
        width: 1300,
        height: 1400,
        gridSize: 100,
        drawGrid: true,
        snapLinks: true,
        embeddingMode: true,
        interactive: function(cellView) {
            if (cellView.model.isElement()) {
                return { elementMove: false }; // Disable element movement
            }
            return true;
        }
    });

    // Center the viewport to allow negative coordinates
    const initialTranslate = {
        x: -100,
        y: 300
    };
    paper.translate(initialTranslate.x, initialTranslate.y);

    // JSON data
    const data = {
        "components": [
			{
				"name": "5 Zone PVAV Supply Inlet Node",
				"type": "node",
                "side": "boundary",
				"row": -1,
				"column": 1,
				"before": [{"name": "5 Zone PVAV Demand Outlet Node", "port":"in"}],
                "after": [{"name": "5 Zone PVAV OA System", "port":"out"}],
				"image": null
			},
            {
				"name": "5 Zone PVAV Relief Air Node",
				"type": "node",
                "side": "outdoor",
				"row": -3,
				"column": 2,
				"before": [{"name": "5 Zone PVAV OA System", "port":"in"}],
                "after": null,
				"image": null
			},
			{
				"name": "5 Zone PVAV Outdoor Air Node",
				"type": "node",
                "side": "outdoor",
				"row": -3,
				"column": 3,
				"before": null,
                "after": [{"name": "5 Zone PVAV OA System", "port":"out"}],
				"image": null
			},
			{
				"name": "5 Zone PVAV OA System",
				"type": "oa_system",
                "side": "supply",
				"row": -2,
				"column": 2,
				"before": [
                    {"name": "5 Zone PVAV Supply Inlet Node", "port":"in"},
                    {"name": "5 Zone PVAV Outdoor Air Node", "port": "outdoor"}
                ],
                "after": [
                    {"name": "5 Zone PVAV Mixed Air Node", "port": "out"},
                    {"name": "5 Zone PVAV Relief Air Node", "port": "relief"}
                ],
				"image": "images/OAMixer.png"
			},
			{
				"name": "5 Zone PVAV Mixed Air Node",
				"type": "node",
                "side": "supply",
				"row": -2,
				"column": 4,
				"before": [{"name": "5 Zone PVAV OA System", "port":"in"}],
				"after": [{"name": "5 Zone PVAV 2spd DX Clg Coil 354kBtu/hr 9.8EER", "port": "out"}],
				"image": null
			},
			{
				"name": "5 Zone PVAV 2spd DX Clg Coil 354kBtu/hr 9.8EER",
				"type": "equipment",
                "side": "supply",
				"row": -2,
				"column": 5,
				"before": [{"name": "5 Zone PVAV Mixed Air Node", "port": "in"}],
				"after": [{"name": "5 Zone PVAV 2spd DX Clg Coil 354kBtu/hr 9.8EER Outlet Air Node", "port": "out"}],
				"image": "images/dxcoolingcoil_2speed.png"
			},
			{
				"name": "5 Zone PVAV 2spd DX Clg Coil 354kBtu/hr 9.8EER Outlet Air Node",
				"type": "node",
                "side": "supply",
				"row": -2,
				"column": 6,
				"before": [{"name": "5 Zone PVAV 2spd DX Clg Coil 354kBtu/hr 9.8EER", "port": "in"}],
				"after": [{"name": "5 Zone PVAV Main Gas Htg Coil", "port": "out"}],
				"image": null
			},
			{
				"name": "5 Zone PVAV Main Gas Htg Coil",
				"type": "equipment",
                "side": "supply",
				"row": -2,
				"column": 7,
				"before": [{"name": "5 Zone PVAV 2spd DX Clg Coil 354kBtu/hr 9.8EER Outlet Air Node", "port": "in"}],
				"after": [{"name": "5 Zone PVAV Main Gas Htg Coil Outlet Air Node", "port": "out"}],
				"image": "images/furnace.png"
			},
			{
				"name": "5 Zone PVAV Main Gas Htg Coil Outlet Air Node",
				"type": "node",
                "side": "supply",
				"row": -2,
				"column": 8,
				"before": [{"name": "5 Zone PVAV Main Gas Htg Coil", "port": "in"}],
				"after": [{"name": "5 Zone PVAV Fan", "port": "out"}],
				"image": null
			},
			{
				"name": "5 Zone PVAV Fan",
				"type": "equipment",
                "side": "supply",
				"row": -2,
				"column": 9,
				"before": [{"name": "5 Zone PVAV Main Gas Htg Coil Outlet Air Node", "port": "in"}],
				"after": [{"name": "5 Zone PVAV Supply Outlet Node", "port": "out"}],
				"image": "images/fan_variable.png"
			},
			{
				"name": "5 Zone PVAV Supply Outlet Node",
				"type": "node",
                "side": "boundary",
				"row": -1,
				"column": 13,
				"before": [{"name": "5 Zone PVAV Fan", "port": "in"}],
				"after": [{"name": "5 Zone PVAV Demand Inlet Node", "port": "out"}],
				"image": null
			},
			{
				"name": "5 Zone PVAV Demand Inlet Node",
				"type": "node",
                "side": "boundary",
				"row": 1,
				"column": 13,
				"before": [{"name": "5 Zone PVAV Supply Outlet Node", "port": "in"}],
				"after": [{"name": "Air Loop HVAC Zone Splitter 1", "port": "out"}],
				"image": null
			},
            {
				"name": "Air Loop HVAC Zone Splitter 1",
				"type": "node",
                "side": "demand",
				"row": 6,
				"column": 12,
				"before": [{"name": "5 Zone PVAV Demand Inlet Node", "port": "in"}],
				"after": [
					{"name": "Perimeter_bot_ZN_1 ZN VAV Terminal Inlet Air Node", "port": "out"},
					{"name": "Perimeter_bot_ZN_2 ZN VAV Terminal Inlet Air Node", "port": "out"},
					{"name": "Perimeter_bot_ZN_3 ZN VAV Terminal Inlet Air Node", "port": "out"},
					{"name": "Perimeter_bot_ZN_4 ZN VAV Terminal Inlet Air Node", "port": "out"},
					{"name": "Core_bottom ZN VAV Terminal Inlet Air Node", "port": "out"}
				],
				"image": null
			},
			{
				"name": "Perimeter_bot_ZN_1 ZN VAV Terminal Inlet Air Node",
				"type": "node",
                "side": "demand",
				"row": 2,
				"column": 10,
				"before": [{"name": "Air Loop HVAC Zone Splitter 1", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_1 ZN VAV Terminal", "port": "out"}],
				"image": null
			},
			{
				"name": "Perimeter_bot_ZN_1 ZN VAV Terminal",
				"type": "equipment",
                "side": "demand",
				"row": 2,
				"column": 9,
				"before": [{"name": "Perimeter_bot_ZN_1 ZN VAV Terminal Inlet Air Node", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_1 ZN VAV Terminal Outlet Air Node", "port": "out"}],
				"image": "images/vav-reheat.png"
			},
			{
				"name": "Perimeter_bot_ZN_1 ZN VAV Terminal Outlet Air Node",
				"type": "node",
                "side": "demand",
				"row": 2,
				"column": 8,
				"before": [{"name": "Perimeter_bot_ZN_1 ZN VAV Terminal", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_1 ZN", "port": "out"}],
				"image": null
			},
			{
				"name": "Perimeter_bot_ZN_1 ZN",
				"type": "equipment",
                "side": "demand",
				"row": 2,
				"column": 7,
				"before": [{"name": "Perimeter_bot_ZN_1 ZN VAV Terminal Outlet Air Node", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_1 ZN Return Air Node", "port": "out"}],
				"image": "images/zone.png"
			},
			{
				"name": "Perimeter_bot_ZN_1 ZN Return Air Node",
				"type": "node",
                "side": "demand",
				"row": 2,
				"column": 6,
				"before": [{"name": "Perimeter_bot_ZN_1 ZN", "port": "in"}],
				"after": [{"name": "Air Loop HVAC Return Plenum 1 1", "port": "out"}],
				"image": null
			},
			{
				"name": "Perimeter_bot_ZN_2 ZN VAV Terminal Inlet Air Node",
				"type": "node",
                "side": "demand",
				"row": 4,
				"column": 10,
				"before": [{"name": "Air Loop HVAC Zone Splitter 1", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_2 ZN VAV Terminal", "port": "out"}],
				"image": null
			},
			{
				"name": "Perimeter_bot_ZN_2 ZN VAV Terminal",
				"type": "equipment",
                "side": "demand",
				"row": 4,
				"column": 9,
				"before": [{"name": "Perimeter_bot_ZN_2 ZN VAV Terminal Inlet Air Node", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_2 ZN VAV Terminal Outlet Air Node", "port": "out"}],
				"image": "images/vav-reheat.png"
			},
			{
				"name": "Perimeter_bot_ZN_2 ZN VAV Terminal Outlet Air Node",
				"type": "node",
                "side": "demand",
				"row": 4,
				"column": 8,
				"before": [{"name": "Perimeter_bot_ZN_2 ZN VAV Terminal", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_2 ZN", "port": "out"}],
				"image": null
			},
			{
				"name": "Perimeter_bot_ZN_2 ZN",
				"type": "equipment",
                "side": "demand",
				"row": 4,
				"column": 7,
				"before": [{"name": "Perimeter_bot_ZN_2 ZN VAV Terminal Outlet Air Node", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_2 ZN Return Air Node", "port": "out"}],
				"image": "images/zone.png"
			},
			{
				"name": "Perimeter_bot_ZN_2 ZN Return Air Node",
				"type": "node",
                "side": "demand",
				"row": 4,
				"column": 6,
				"before": [{"name": "Perimeter_bot_ZN_2 ZN", "port": "in"}],
				"after": [{"name": "Air Loop HVAC Return Plenum 1 2", "port": "out"}],
				"image": null
			},
			{
				"name": "Perimeter_bot_ZN_3 ZN VAV Terminal Inlet Air Node",
				"type": "node",
                "side": "demand",
				"row": 6,
				"column": 10,
				"before": [{"name": "Air Loop HVAC Zone Splitter 1", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_3 ZN VAV Terminal", "port": "out"}],
				"image": null
			},
			{
				"name": "Perimeter_bot_ZN_3 ZN VAV Terminal",
				"type": "equipment",
                "side": "demand",
				"row": 6,
				"column": 9,
				"before": [{"name": "Perimeter_bot_ZN_3 ZN VAV Terminal Inlet Air Node", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_3 ZN VAV Terminal Outlet Air Node", "port": "out"}],
				"image": "images/vav-reheat.png"
			},
			{
				"name": "Perimeter_bot_ZN_3 ZN VAV Terminal Outlet Air Node",
				"type": "node",
                "side": "demand",
				"row": 6,
				"column": 8,
				"before": [{"name": "Perimeter_bot_ZN_3 ZN VAV Terminal", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_3 ZN", "port": "out"}],
				"image": null
			},
			{
				"name": "Perimeter_bot_ZN_3 ZN",
				"type": "equipment",
                "side": "demand",
				"row": 6,
				"column": 7,
				"before": [{"name": "Perimeter_bot_ZN_3 ZN VAV Terminal Outlet Air Node", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_3 ZN Return Air Node", "port": "out"}],
				"image": "images/zone.png"
			},
			{
				"name": "Perimeter_bot_ZN_3 ZN Return Air Node",
				"type": "node",
                "side": "demand",
				"row": 6,
				"column": 6,
				"before": [{"name": "Perimeter_bot_ZN_3 ZN", "port": "in"}],
				"after": [{"name": "Air Loop HVAC Return Plenum 1 3", "port": "out"}],
				"image": null
			},
			{
				"name": "Perimeter_bot_ZN_4 ZN VAV Terminal Inlet Air Node",
				"type": "node",
                "side": "demand",
				"row": 8,
				"column": 10,
				"before": [{"name": "Air Loop HVAC Zone Splitter 1", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_4 ZN VAV Terminal", "port": "out"}],
				"image": null
			},
			{
				"name": "Perimeter_bot_ZN_4 ZN VAV Terminal",
				"type": "equipment",
                "side": "demand",
				"row": 8,
				"column": 9,
				"before": [{"name": "Perimeter_bot_ZN_4 ZN VAV Terminal Inlet Air Node", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_4 ZN VAV Terminal Outlet Air Node", "port": "out"}],
				"image": "images/vav-reheat.png"
			},
			{
				"name": "Perimeter_bot_ZN_4 ZN VAV Terminal Outlet Air Node",
				"type": "node",
                "side": "demand",
				"row": 8,
				"column": 8,
				"before": [{"name": "Perimeter_bot_ZN_4 ZN VAV Terminal", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_4 ZN", "port": "out"}],
				"image": null
			},
			{
				"name": "Perimeter_bot_ZN_4 ZN",
				"type": "equipment",
                "side": "demand",
				"row": 8,
				"column": 7,
				"before": [{"name": "Perimeter_bot_ZN_4 ZN VAV Terminal Outlet Air Node", "port": "in"}],
				"after": [{"name": "Perimeter_bot_ZN_4 ZN Return Air Node", "port": "out"}],
				"image": "images/zone.png"
			},
			{
				"name": "Perimeter_bot_ZN_4 ZN Return Air Node",
				"type": "node",
                "side": "demand",
				"row": 8,
				"column": 6,
				"before": [{"name": "Perimeter_bot_ZN_4 ZN", "port": "in"}],
				"after": [{"name": "Air Loop HVAC Return Plenum 1 4", "port": "out"}],
				"image": null
			},
			{
				"name": "Core_bottom ZN VAV Terminal Inlet Air Node",
				"type": "node",
                "side": "demand",
				"row": 10,
				"column": 10,
				"before": [{"name": "Air Loop HVAC Zone Splitter 1", "port": "in"}],
				"after": [{"name": "Core_bottom ZN VAV Terminal", "port": "out"}],
				"image": null
			},
			{
				"name": "Core_bottom ZN VAV Terminal",
				"type": "equipment",
                "side": "demand",
				"row": 10,
				"column": 9,
				"before": [{"name": "Core_bottom ZN VAV Terminal Inlet Air Node", "port": "in"}],
				"after": [{"name": "Core_bottom ZN VAV Terminal Outlet Air Node", "port": "out"}],
				"image": "images/vav-reheat.png"
			},
			{
				"name": "Core_bottom ZN VAV Terminal Outlet Air Node",
				"type": "node",
                "side": "demand",
				"row": 10,
				"column": 8,
				"before": [{"name": "Core_bottom ZN VAV Terminal", "port": "in"}],
				"after": [{"name": "Core_bottom ZN", "port": "out"}],
				"image": null
			},
			{
				"name": "Core_bottom ZN",
				"type": "equipment",
                "side": "demand",
				"row": 10,
				"column": 7,
				"before": [{"name": "Core_bottom ZN VAV Terminal Outlet Air Node", "port": "in"}],
				"after": [{"name": "Core_bottom ZN Return Air Node", "port": "out"}],
				"image": "images/zone.png"
			},
			{
				"name": "Core_bottom ZN Return Air Node",
				"type": "node",
                "side": "demand",
				"row": 10,
				"column": 6,
				"before": [{"name": "Core_bottom ZN", "port": "in"}],
				"after": [{"name": "Air Loop HVAC Return Plenum 1 5", "port": "out"}],
				"image": null
			},
			{
				"name": "Air Loop HVAC Return Plenum 1 1",
				"type": "node",
                "side": "demand",
				"row": 2,
				"column": 5,
				"before": [{"name": "Perimeter_bot_ZN_1 ZN Return Air Node", "port": "in"}],
				"after": [{"name": "Node 32 1", "port": "out"}],
				"image": null
			},
            {
				"name": "Air Loop HVAC Return Plenum 1 2",
				"type": "node",
                "side": "demand",
				"row": 4,
				"column": 5,
				"before": [{"name": "Perimeter_bot_ZN_2 ZN Return Air Node", "port": "in"}],
				"after": [{"name": "Node 32 2", "port": "out"}],
				"image": null
			},
            {
				"name": "Air Loop HVAC Return Plenum 1 3",
				"type": "node",
                "side": "demand",
				"row": 6,
				"column": 5,
				"before": [{"name": "Perimeter_bot_ZN_3 ZN Return Air Node", "port": "in"}],
				"after": [{"name": "Node 32 3", "port": "out"}],
				"image": null
			},
            {
				"name": "Air Loop HVAC Return Plenum 1 4",
				"type": "node",
                "side": "demand",
				"row": 8,
				"column": 5,
				"before": [{"name": "Perimeter_bot_ZN_4 ZN Return Air Node", "port": "in"}],
				"after": [{"name": "Node 32 4", "port": "out"}],
				"image": null
			},
            {
				"name": "Air Loop HVAC Return Plenum 1 5",
				"type": "node",
                "side": "demand",
				"row": 10,
				"column": 5,
				"before": [{"name": "Core_bottom ZN Return Air Node", "port": "in"}],
				"after": [{"name": "Node 32 5", "port": "out"}],
				"image": null
			},
			{
				"name": "Node 32 1",
				"type": "node",
                "side": "demand",
				"row": 2,
				"column": 4,
				"before": [{"name": "Air Loop HVAC Return Plenum 1 1", "port": "in"}],
				"after": [{"name": "Air Loop HVAC Zone Mixer 1", "port": "out"}],
				"image": null
			},
            {
				"name": "Node 32 2",
				"type": "node",
                "side": "demand",
				"row": 4,
				"column": 4,
				"before": [{"name": "Air Loop HVAC Return Plenum 1 2", "port": "in"}],
				"after": [{"name": "Air Loop HVAC Zone Mixer 1", "port": "out"}],
				"image": null
			},
            {
				"name": "Node 32 3",
				"type": "node",
                "side": "demand",
				"row": 6,
				"column": 4,
				"before": [{"name": "Air Loop HVAC Return Plenum 1 3", "port": "in"}],
				"after": [{"name": "Air Loop HVAC Zone Mixer 1", "port": "out"}],
				"image": null
			},
            {
				"name": "Node 32 4",
				"type": "node",
                "side": "demand",
				"row": 8,
				"column": 4,
				"before": [{"name": "Air Loop HVAC Return Plenum 1 4", "port": "in"}],
				"after": [{"name": "Air Loop HVAC Zone Mixer 1", "port": "out"}],
				"image": null
			},
            {
				"name": "Node 32 5",
				"type": "node",
                "side": "demand",
				"row": 10,
				"column": 4,
				"before": [{"name": "Air Loop HVAC Return Plenum 1 5", "port": "in"}],
				"after": [{"name": "Air Loop HVAC Zone Mixer 1", "port": "out"}],
				"image": null
			},
            {
				"name": "Air Loop HVAC Zone Mixer 1",
				"type": "node",
                "side": "demand",
				"row": 6,
				"column": 2,
				"before": [
                    {"name": "Node 32 1", "port": "in"},
                    {"name": "Node 32 2", "port": "in"},
                    {"name": "Node 32 3", "port": "in"},
                    {"name": "Node 32 4", "port": "in"},
                    {"name": "Node 32 5", "port": "in"},
                ],
				"after": [{"name": "5 Zone PVAV Demand Outlet Node", "port": "out"}],
				"image": null
			},
			{
				"name": "5 Zone PVAV Demand Outlet Node",
				"type": "node",
                "side": "boundary",
				"row": 1,
				"column": 1,
				"before": [{"name": "Air Loop HVAC Zone Mixer 1", "port": "in"}],
				"after": [{"name": "5 Zone PVAV Supply Inlet Node", "port": "out"}],
				"image": null
			},
		]
    };

    const topPort= {
        position: { name: 'top' },
        markup: [{ tagName: 'rect' }]
    };

    const bottomPort= {
        position: { name: 'bottom' },
        markup: [{ tagName: 'rect' }]
    };

    const leftPort= {
        position: { name: 'left' },
        markup: [{ tagName: 'rect' }]
    };

    const rightPort= {
        position: { name: 'right' },
        markup: [{ tagName: 'rect' }]
    };

    const relativePort= {
        position: { name: 'relative' },
        markup: [{ tagName: 'rect' }]
    };

    function setPortConfig(side) {
        if (side === "supply") {
            return {
                groups: {
                    "left": leftPort,
                    "right": rightPort
                },
                items: [
                    {id: 'in', group: "left"},
                    {id: 'out', group: "right"}
                ]
            };
        } else if (side === "demand") {
            return {
                groups: {
                    "left": leftPort,
                    "right": rightPort
                },
                items: [
                    {id: 'in', group: "right"},
                    {id: 'out', group: "left"}
                ]
            };
        } else {
            return null;
        }
    }

    function createNode(name, row, column, side) {
        const portConfig = setPortConfig(side)
        let node = new joint.shapes.standard.Ellipse({
            id: name,
            size: {width: 25, height: 25},
            position: {x: column * 100 + 37.5, y: row * 100 + 37.5},
            attrs: {
                body: {
                    fill: 'white'
                }
            },
            ports: portConfig
        });
        node.addTo(graph);
        return node;
    }

    function createEquipment(name, row, column, image, side) {
        const portConfig = setPortConfig(side)
        let equipment = new joint.shapes.standard.Image({
            id: name,
            position: {x: column * 100, y: row * 100},
            size: {width: 100, height: 100},
            attrs: {image: {'xlink:href': image}},
            ports: portConfig
        });
        equipment.addTo(graph);
        return equipment;
    }

    function createOASystem(name, row, column, image) {
        let oa_sys = new joint.shapes.standard.Image({
            id: name,
            position: {x: column * 100, y: row * 100},
            size: {width: 200, height: 100},
            attrs: {image: {'xlink:href': image}},
            ports: {
                groups: {
                    "relative":relativePort
                },
                items: [
                    {
                        id: 'in',
                        group: "relative",
                        args: {x: '0%', y: '50%'}
                    },
                    {
                        id: 'relief',
                        group: "relative",
                        args: {x: '25%', y: '0%'}
                    },
                    {
                        id: 'outdoor',
                        group: "relative",
                        args: {x: '75%', y: '0%'}
                    },
                    {
                        id: 'out',
                        group: "relative",
                        args: {x: '100%', y: '50%'}
                    }
                ]
            }
        });
        oa_sys.addTo(graph);
        return oa_sys;
    }

    // Create elements from json
    const elements = {}
    data.components.forEach(function(component) {
        let element;
        if (component.type === 'node') {
            element = createNode(component.name, component.row, component.column, component.side)
        } else if (component.type === 'equipment') {
            element = createEquipment(component.name, component.row, component.column, component.image, component.side)
        } else if (component.type === 'oa_system') {
            element = createOASystem(component.name, component.row, component.column, component.image)
        }

        elements[component.name] = element;
    });

    // Link elements from json
    data.components.forEach(function(component) {
        if (component.after) {
            component.after.forEach(function(afterComponent) {
                const targetComponent = data.components.find(comp => comp.name === afterComponent.name);
                if (targetComponent && targetComponent.before) {
                    const targetPort = targetComponent.before.find(before => before && before.name === component.name);
                    if (targetPort) {
                        const link = new joint.shapes.standard.Link();
                        link.source({id: elements[component.name], port: afterComponent.port});
                        link.target({id: elements[afterComponent.name], port: targetPort.port});
                        // Calculate the midpoint between the source and target
                        const sourceElement = elements[component.name];
                        const targetElement = elements[afterComponent.name];
                        console.log(component.name)
                        const sourceBBox = sourceElement.getBBox();
                        const targetBBox = targetElement.getBBox();

                        const sourceCenter = sourceBBox.center();
                        const targetCenter = targetBBox.center();
                        console.log(targetCenter)

                        const midPoint = {
                            x: (sourceCenter.x + targetCenter.x) / 2,
                            y: (sourceCenter.y + targetCenter.y) / 2
                        };
                        // console.log(midPoint)
                        // Set the midpoint as a vertex
                        link.vertices([midPoint]);

                        link.router('manhattan');
                        link.addTo(graph);
                    }
                }
            });
        }
    });

    paper.on('element:pointerclick', function(elementView) {
        const element = elementView.model;
        alert('Clicked on ' + element.id);
    });
</script>

</body>
</html>
